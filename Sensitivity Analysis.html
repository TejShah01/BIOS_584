<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MHA Capital Budgeting Dashboard</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f7;
      color: #222;
    }
    h1 {
      margin-bottom: 0.25rem;
    }
    .subtitle {
      margin-top: 0;
      margin-bottom: 1.5rem;
      color: #555;
      font-size: 0.95rem;
    }
    .controls {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }
    .controls label {
      font-weight: 600;
    }
    .controls input[type="number"] {
      padding: 0.4rem 0.6rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      width: 100px;
      font-size: 0.95rem;
    }
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem;
    }
    .card {
      background: white;
      border-radius: 10px;
      padding: 1rem 1.2rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
    .card-title {
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: #666;
      margin-bottom: 0.3rem;
    }
    .card-value {
      font-size: 1.4rem;
      font-weight: 700;
    }
    .card-sub {
      margin-top: 0.25rem;
      font-size: 0.8rem;
      color: #777;
    }
  </style>
</head>
<body>
  <h1>MHA Capital Budgeting Model</h1>
  <p class="subtitle">
    Adjust Year 1 student enrollment and see key financial metrics update in real time.
  </p>

  <div class="controls">
    <label for="studentsInput">Year 1 students:</label>
    <input
      id="studentsInput"
      type="number"
      min="0"
      step="1"
      value="12"
      oninput="recalculate()"
    />
  </div>

  <div class="metrics-grid">
    <div class="card">
      <div class="card-title">Year 5 Cumulative Cash Flow</div>
      <div class="card-value" id="cumCFDisplay">–</div>
    </div>

    <div class="card">
      <div class="card-title">NPV @ 10%</div>
      <div class="card-value" id="npvDisplay">–</div>
    </div>

    <div class="card">
      <div class="card-title">Payback Period</div>
      <div class="card-value" id="paybackDisplay">–</div>
    </div>

    <div class="card">
      <div class="card-title">IRR</div>
      <div class="card-value" id="irrDisplay">–</div>
    </div>

    <div class="card">
      <div class="card-title">MIRR</div>
      <div class="card-value" id="mirrDisplay">–</div>
    </div>
  </div>

  <script>
    const YEAR0_CF = -200000;

    const FIXED_YEARS = [
      -1810800,
      -1840950,
      -1873203.75,
      -1907343.84375,
      -1943201.43984375
    ];

    const TUITION_BASE = 90000;
    const TUITION_GROWTH = 0.04;
    const DISCOUNT_PERCENT = 0.02;
    const DISCOUNT_RATE = 0.10;

    function npv(rate, cashflows) {
      let total = cashflows[0];
      for (let t = 1; t < cashflows.length; t++) {
        total += cashflows[t] / Math.pow(1 + rate, t);
      }
      return total;
    }

    function irr(cashflows) {
      const npvAtRate = (r) => {
        let total = 0;
        for (let t = 0; t < cashflows.length; t++) {
          total += cashflows[t] / Math.pow(1 + r, t);
        }
        return total;
      };

      let low = -0.99;
      let high = 5.0;

      let npvLow = npvAtRate(low);
      let npvHigh = npvAtRate(high);
      if (npvLow * npvHigh > 0) return NaN;

      let mid = 0;
      for (let i = 0; i < 100; i++) {
        mid = (low + high) / 2;
        const npvMid = npvAtRate(mid);
        if (Math.abs(npvMid) < 1e-7) break;
        if (npvLow * npvMid < 0) {
          high = mid;
          npvHigh = npvMid;
        } else {
          low = mid;
          npvLow = npvMid;
        }
      }
      return mid;
    }

    function mirr(cashflows, financeRate, reinvestRate) {
      const n = cashflows.length;
      let pvNeg = 0, fvPos = 0;

      for (let t = 0; t < n; t++) {
        const cf = cashflows[t];
        if (cf < 0) pvNeg += cf / Math.pow(1 + financeRate, t);
      }

      for (let t = 0; t < n; t++) {
        const cf = cashflows[t];
        if (cf > 0) fvPos += cf * Math.pow(1 + reinvestRate, (n - 1 - t));
      }

      if (pvNeg === 0 || fvPos === 0) return NaN;
      return Math.pow(Math.abs(fvPos / pvNeg), 1 / (n - 1)) - 1;
    }

    function computeCashflows(B3) {
      const s1 = B3;
      const s2 = s1 * 1.75;
      const s3 = s2 * 1.2;
      const s4 = s3 + 1;
      const s5 = s4 + 1;
      const students = [s1, s2, s3, s4, s5];

      const tuition = [];
      for (let i = 0; i < 5; i++) {
        tuition.push(TUITION_BASE * Math.pow(1 + TUITION_GROWTH, i));
      }

      const tuitionCF = [];
      for (let i = 0; i < 5; i++) {
        const revenue = students[i] * tuition[i];
        const discount = -DISCOUNT_PERCENT * revenue;
        tuitionCF.push(tuition[i] + revenue + discount);
      }

      const cashflows = [YEAR0_CF];
      for (let i = 0; i < 5; i++) {
        cashflows.push(tuitionCF[i] + FIXED_YEARS[i]);
      }

      return { cashflows };
    }

    function formatCurrency(x) {
      if (!isFinite(x)) return "N/A";
      return x.toLocaleString("en-US", { style: "currency", currency: "USD", maximumFractionDigits: 0 });
    }

    function formatPercent(x) {
      if (!isFinite(x)) return "N/A";
      return (x * 100).toFixed(2) + "%";
    }

    function formatYears(x) {
      if (!isFinite(x)) return "N/A";
      return x.toFixed(2) + " yrs";
    }

    function recalculate() {
      let B3 = parseFloat(document.getElementById("studentsInput").value);
      if (isNaN(B3) || B3 < 0) B3 = 0;

      const { cashflows } = computeCashflows(B3);

      let cumulative = 0;
      const cum = [];
      for (let i = 0; i < cashflows.length; i++) {
        cumulative += cashflows[i];
        cum.push(cumulative);
      }

      document.getElementById("cumCFDisplay").textContent = formatCurrency(cum[5]);
      document.getElementById("npvDisplay").textContent = formatCurrency(npv(DISCOUNT_RATE, cashflows));
      document.getElementById("irrDisplay").textContent = formatPercent(irr(cashflows));
      document.getElementById("mirrDisplay").textContent = formatPercent(mirr(cashflows, DISCOUNT_RATE, DISCOUNT_RATE));

      const H46 = cum[3];
      const I44 = cashflows[4];
      const payback = 3 + (-H46 / I44);

      document.getElementById("paybackDisplay").textContent = formatYears(payback);
    }

    window.addEventListener("DOMContentLoaded", recalculate);
  </script>
</body>
</html>
